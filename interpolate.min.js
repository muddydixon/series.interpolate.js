var copyObj,d3,estimeteStepwise,expect,getGCD,getTargetVal,interpolate;d3=require("d3"),interpolate=function(e,t){var r,n,a,i,o,u,p,l,s,c,f;for(t=t||{},o=t.index||"x",c=t.step||estimeteStepwise(e,o),a=t.defaults,n=getTargetVal(e[0],o),r=null!=e[0][o]?e[0][o].constructor:e[0].constructor,i=0,s=getTargetVal(e[i],o);++i<e.length;)n=getTargetVal(e[i],o),n-s!==c&&(u=(n-s)/c,l=d3.interpolate(e[i-1],e[i]),p=function(){f=[];for(var e=1,t=u-1;t>=1?t>=e:e>=t;t>=1?e++:e--)f.push(e);return f}.apply(this).map(function(e){var t,n;return t=l(e/u),null!=t[o]?(n=new r(t[o]),null!=a&&(t=copyObj(a)),t[o]=n):null!=a&&(t=copyObj(a)),copyObj(t)}),Array.prototype.splice.apply(e,[i,0].concat(p)),i+=p.length),s=n;return e},copyObj=function(e){return JSON.parse(JSON.stringify(e))},estimeteStepwise=function(e,t){var r,n,a,i,o,u,p,l;for(o={},r=getTargetVal(e[0],t),n=p=1,l=e.length-1;l>=1?l>=p:p>=l;n=l>=1?++p:--p)a=r,r=getTargetVal(e[n],t),o[r-a]||(o[r-a]=0),o[r-a]++;return u=function(){var e;e=[];for(i in o)e.push(i);return e}(),getGCD(u)},getTargetVal=function(e,t){if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Date)return e.getTime();if("string"==typeof e)return e;if(null!=t&&null!=e[t])return e[t];throw"cannot estimate stepwise, `index` or `step` should be given"},getGCD=function(e){var t,r,n,a,i;for(n=function(e,t){for(var r;0!==t;)r=e%t,e=t,t=r;return e},t=e[0],r=a=1,i=e.length-1;i>=1?i>=a:a>=i;r=i>=1?++a:--a)if(t=n(t,e[r]),1===t)return 1;return t},module.exports=interpolate,null==module.parent&&(expect=require("chai").expect,expect(estimeteStepwise([1,4,6,8])).to.equal(1),expect(estimeteStepwise([{x:1},{x:4},{x:6},{x:8}],"x")).to.equal(1),expect(estimeteStepwise([{x:new Date(2013,0,1)},{x:new Date(2013,0,4)},{x:new Date(2013,0,6)},{x:new Date(2013,0,8)}],"x")).to.equal(864e5),expect(estimeteStepwise([4,7,10,16,22,28])).to.equal(3));